(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function a(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerpolicy&&(r.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?r.credentials="include":n.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(n){if(n.ep)return;n.ep=!0;const r=a(n);fetch(n.href,r)}})();function pe(e){return`
  <i class=${e>=1?"'fas  fa-star'":e>=.5?"'fas fa-star-half-alt'":"'far fa-star'"}></i>
  <i class=${e>=2?"'fas fa-star'":e>=1.5?"'fas fa-star-half-alt'":"'far fa-star'"}></i>
  <i class=${e>=3?"'fas fa-star'":e>=2.5?"'fas fa-star-half-alt'":"'far fa-star'"}></i>
  <i class=${e>=4?"'fas fa-star'":e>=3.5?"'fas fa-star-half-alt'":"'far fa-star'"}></i>
  <i class=${e>=5?"'fas fa-star'":e>=4.5?"'fas fa-star-half-alt'":"'far fa-star'"}></i>
  `}const j=[{_id:1,name:"Rascador T-4000",image:["img/products/scraper.jpg","img/products/scraperModal1.jpg","img/products/scraperModal2.jpg","img/products/scraperModal3.jpg"],description:"Los gatos tienen un impulso natural de rascarse: la acci\xF3n les ayuda a eliminar material viejo de sus garras y marcar el territorio con las gl\xE1ndulas olorosas de sus patas.",price:89,rating:4},{_id:2,name:"Headphone Pro",image:["img/products/headphone.jpg","img/products/headphoneModal1.jpg","img/products/headphoneModal2.jpg","img/products/headphoneModal3.jpg"],description:"El Headphone Pro tiene bajos m\xE1s potentes, mejora la experiencia de audio, proporciona una alta calidad de sonido.",price:150,rating:3.5},{_id:3,name:"Mochila Pet 7000",image:["img/products/mochila.jpg","img/products/mochilaModal1.jpg","img/products/mochilaModal2.jpg","img/products/mochilaModal3.jpg"],description:"Ideal para visitas al veterinario, paseos, viajes, o para llevarla donde quieras!, Incluye varios orificios amplios para ventilaci\xF3n, adem\xE1s de contar con un acr\xEDlico que protege a tu mascota.",price:99,rating:4.5}];function T(e,t){localStorage.setItem(e,JSON.stringify(t))}function g(e){return JSON.parse(localStorage.getItem(e))}function X(e,t){sessionStorage.setItem(e,JSON.stringify(t))}function A(e){return JSON.parse(sessionStorage.getItem(e))}function J(e){sessionStorage.removeItem(e)}const w=16,K=w,fe=function(e){return btoa(String.fromCharCode(...new Uint8Array(e)))},ye=function(e){return Uint8Array.from(atob(e),t=>t.charCodeAt(0))},ee=async function(e){const t=new TextEncoder;let a="AES-CBC",o=await window.crypto.subtle.importKey("raw",t.encode(e.password),{name:"PBKDF2"},!1,["deriveKey"]);return await window.crypto.subtle.deriveKey({name:"PBKDF2",salt:t.encode(e.sal.toString()),iterations:e.iterations,hash:e.hash},o,{name:a,length:e.longitude},!1,["encrypt","decrypt"])};async function U(e,t){const a=new TextEncoder,o=window.crypto.getRandomValues(new Uint8Array(16)),n=window.crypto.getRandomValues(new Uint8Array(16)),r=a.encode(t),i=ee({password:e,sal:o,iterations:1e5,longitude:256,hash:"SHA-256"}),d=await window.crypto.subtle.encrypt({name:"AES-CBC",iv:n},await i,r);return fe([...o,...n,...new Uint8Array(d)])}async function te(e,t){const a=new TextDecoder,o=ye(t),n=o.slice(0,w),r=o.slice(0+w,w+K),i=ee({password:e,sal:n,iterations:1e5,longitude:256,hash:"SHA-256"}),d=await window.crypto.subtle.decrypt({name:"AES-CBC",iv:r},await i,o.slice(w+K));return a.decode(d)}let I;const ge=new Uint8Array(16);function ve(){if(!I&&(I=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!I))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return I(ge)}const u=[];for(let e=0;e<256;++e)u.push((e+256).toString(16).slice(1));function be(e,t=0){return(u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+"-"+u[e[t+4]]+u[e[t+5]]+"-"+u[e[t+6]]+u[e[t+7]]+"-"+u[e[t+8]]+u[e[t+9]]+"-"+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]).toLowerCase()}const he=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),G={randomUUID:he};function ae(e,t,a){if(G.randomUUID&&!t&&!e)return G.randomUUID();e=e||{};const o=e.random||(e.rng||ve)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,t){a=a||0;for(let n=0;n<16;++n)t[a+n]=o[n];return t}return be(o)}const Ee=new Intl.NumberFormat(void 0,{currency:"USD",style:"currency"});function N(e){return Ee.format(e)}const Se=j;function xe(e){const t=document.querySelector("#divAccordion");e.purchase.reverse().map((a,o)=>{const n=document.createElement("h2");n.className="accordion-header",n.id="accordion"+o;const r=document.createElement("button");r.className="accordion-button",r.type="button",r.setAttribute("data-bs-toggle","collapse"),r.setAttribute("data-bs-target","#colpase"+o),r.setAttribute("aria-expanded","true"),r.setAttribute("aria-controls","colpase"+o);const c=new Date(a.date).toLocaleDateString(void 0,{weekday:"short",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"});r.innerText=c;const i=document.createElement("div");i.id="colpase"+o,i.className="accordion-collapse collapse show",i.setAttribute("aria-labelledby","accordion"+o);const d=document.createElement("div");d.className="accordion-body px-1";const p=document.createElement("span");p.className="fw-600",p.innerText="ID: "+a._id;const s=document.createElement("table");s.className="table table-sm table-bordered mt-2",s.innerHTML+=`
    <thead>
       <tr>        
        <th scope="col">Producto</th>
        <th scope="col">P.U</th>
        <th scope="col">Subtotal</th>        
      </tr>
    </thead>       
    `;let f=0;for(let l=0;l<a.items.length;l++){const y=Se.find(v=>v._id===a.items[l]._id);f+=a.items[l].quantity*y.price,s.innerHTML+=`          
        <tbody>
          <tr >            
            <td scope="row">
              <a href="#staticBackdrop${y._id}" data-bs-toggle="modal">
               ${y.name+" - x"+a.items[l].quantity}
              </a>
            </td>
            <td class="text-end">${y.price}</td>
            <td class="text-end">${a.items[l].quantity*y.price}</td>
          </tr>    
        </tbody>`}s.innerHTML+=`
      <tfoot>
        <tr class="text-end"> 
          <td></td>           
          <td class="fw-bolder">Total: </td>
          <td>${N(f)}</td>
        </tr>   
      </tfoot>`,n.append(r),d.append(p,s),i.append(d),t.append(n),t.append(i)})}const Q=document.querySelector("#accordionItems"),we=g("users");function _(e){Q.innerHTML="";const t=document.createElement("div");t.id="divAccordion";const a=document.createElement("div");a.className="card mb-2";const o=document.createElement("div");o.className="card-header d-flex flex-row justify-content-between";const n=document.createElement("p");n.innerText="Hola, "+e.username;const r=document.createElement("a");r.href="#",r.innerText="Cerrar sesi\xF3n",r.addEventListener("click",l=>{l.preventDefault(),J("user"),location.reload()});const c=document.createElement("ul");c.className="list-group list-group-flush";const i=document.createElement("li");i.className="list-group-item",i.innerText=e.email;const d=document.createElement("li");d.className="list-group-item d-flex flex-row justify-content-between";const p=document.createElement("p");p.innerText="Compras realizadas: "+e.purchase.length;const s=document.createElement("button");s.type="button",s.className="btn btn-danger icon-cart",s.title="Eliminar cuenta";const f=document.createElement("i");f.className="fas fa-trash-alt",s.append(f),s.addEventListener("click",()=>{if(confirm("\xBFQuieres borrar este perfil y sus datos?")){let l=we.filter(y=>y.email!==e.email);T("users",l),J("user"),location.reload()}return null}),d.append(p,s),o.append(n,r),a.append(o),a.append(c),c.append(i,d),t.append(a),Q.append(t),e.purchase.length>0&&xe(e)}const Le=document.querySelector("#nav-profile-tab");async function Ne(){const e=g("carrito"),t=A("user"),a=g("users");t.purchase.push({_id:ae(),date:new Date,items:e}),X("user",t),Le.click();const o=await te(t.email,t._id),n=await U(o,JSON.stringify({email:t.email,username:t.username,_id:t._id,purchase:t.purchase})),r=a.map(c=>c.email===t.email?{...c,user:n}:c);Te(r),alert("Gracias por su compra "+t.username),_(t)}function Te(e){ce(),T("users",e),T("carrito",[]),ne()}const C=document.querySelector("#cartContainer"),z=document.querySelector("#precioTotal"),L=document.querySelector("#btnPay"),W=document.querySelector("#contadorCarrito"),qe=document.querySelector("#loginRegisterModal"),Ie=j;function Ce(e){let t=0,a=0;e.length===0&&(C.innerHTML="",z.innerText="DSS",L.innerText="M\xE9dios de pago",L.classList.add("disabled"),W.innerText="0"),e.map(o=>{const n=Ie.find(me=>me._id===o._id);a+=o.quantity,W.innerText=a.toString();const r=document.createElement("div");r.className="d-flex align-items-center gap-2 mb-2";const c=document.createElement("a");c.href="#staticBackdrop"+n._id,c.setAttribute("data-bs-toggle","modal");const i=document.createElement("img");i.src=n.image[0],i.className="img-cart img-thumbnail";const d=document.createElement("div");d.className="d-flex flex-wrap justify-content-between w-100 gap-2 me-auto";const p=document.createElement("div");p.className="me-auto";const s=document.createElement("div");s.innerText=n.name+" ",s.className="justify-content-start ";const f=document.createElement("span");f.className="text-muted quantity-cart",f.innerText="x "+o.quantity.toString();const l=document.createElement("div");l.className="text-muted price-cart",l.innerText=N(n.price).toString();const y=document.createElement("div");y.innerText=N(n.price*o.quantity).toString(),t+=n.price*o.quantity;const v=document.createElement("div");v.className="d-flex flex-wrap gap-1 col-12";const h=document.createElement("button");h.type="button",h.className="btn btn-outline-primary icon-cart",h.addEventListener("click",()=>{Ae(o._id)});const F=document.createElement("i");F.className="fas fa-minus";const E=document.createElement("button");E.type="button",E.className="btn btn-danger icon-cart",E.addEventListener("click",()=>{confirm("Desea eliminar el producto: "+(n==null?void 0:n.name))&&$e(o._id)});const H=document.createElement("i");H.className="fas fa-trash-alt";const S=document.createElement("button");S.type="button",S.className="btn btn-outline-primary icon-cart",S.addEventListener("click",()=>{oe(o._id)});const V=document.createElement("i");return V.className="fas fa-plus",h.append(F),E.append(H),S.append(V),o.quantity>1&&(s.append(f),v.append(h)),p.append(s),p.append(l),v.append(E),v.append(S),d.append(p),d.append(y),d.append(v),c.append(i),r.append(c),r.append(d),z.innerText="Total "+N(t).toString(),L.innerText="Pagar",L.classList.remove("disabled"),C==null?void 0:C.append(r)})}L.addEventListener("click",()=>{A("user")?Ne():(alert("Registrese o inicie sesi\xF3n para completar la venta"),qe.click())});let m=[];const ke=document.querySelector("#cartContainer");function ne(){m=g("carrito"),D(m),m.forEach(e=>{e!=null&&e._id&&M(e._id,!0)})}function oe(e){m.find(t=>t._id===e)==null?m=[...m,{_id:e,quantity:1}]:m.map(t=>t._id===e?(t.quantity+=1,{...t,quantity:t.quantity}):t),D(m),M(e,!0)}function Ae(e){var t;((t=m.find(a=>a._id===e))==null?void 0:t.quantity)===1?(m=m.filter(a=>a._id!==e),M(e,!1)):m.map(a=>a._id===e?(a.quantity-=1,{...a,quantity:a.quantity}):a),D(m)}function $e(e){m=m.filter(t=>t._id!==e),D(m),M(e,!1)}function M(e,t){const a=document.querySelector("#icon"+e);t?a.className="fas fa-check-circle ms-1":a.className=" "}function D(e){ke.innerHTML="",Ce(e),T("carrito",e)}function Me({_id:e,name:t,image:a,description:o}){return document.getElementById("productModal").innerHTML+=`
  <div class="modal fade" id="staticBackdrop${e}" key="${e}" >
    <div class="modal-dialog modal-md ">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title px-0" id="exampleModalLabel">${t}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="container-fluid">
            <div class="row">
              <div class="col-12">
                <div id="carouselExampleIndicators${e}" class="carousel carousel-dark slide" data-bs-ride="carousel">
                  <div class="carousel-indicators">
                    <button type="button" data-bs-target="#carouselExampleIndicators${e}" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                    <button type="button" data-bs-target="#carouselExampleIndicators${e}" data-bs-slide-to="1" aria-label="Slide 2"></button>
                    <button type="button" data-bs-target="#carouselExampleIndicators${e}" data-bs-slide-to="2" aria-label="Slide 3"></button>
                  </div>
                  <div class="carousel-inner text-center">
                    ${a.map((n,r)=>r>0&&r<=3?`<div class="carousel-item  ${r===1?"active":""}">
                          <img src="${n}" class="d-block w-100 img-thumbnail" alt="${t}">
                        </div>`:null)}
                  </div>
                  <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators${e}" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                  </button>
                  <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators${e}" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                  </button>
                </div>
              </div>
              <div class="col-12  text-center pt-2">
                <p>${o}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>`}const k=document.querySelector("#productSection"),De=document.querySelector("#activateCart"),re=j;function ce(){k.innerHTML=" ",re.forEach(e=>{const t=document.createElement("div");t.className="col";const a=document.createElement("div");a.className="card";const o=document.createElement("a");o.href="#staticBackdrop"+e._id,o.setAttribute("data-bs-toggle","modal");const n=document.createElement("img");n.src=e.image[0],n.className="card-img-top",n.setAttribute("alt",e.name);const r=document.createElement("div");r.className="card-body";const c=document.createElement("span");c.textContent=e.name,c.className="card-title d-flex justify-content-between bgn fs-3 mb-2";const i=document.createElement("span");i.innerText=N(e.price).toString(),i.className="fs-6";const d=document.createElement("div");d.innerHTML=pe(e.rating);const p=document.createElement("div");p.className="d-grid col-6 mx-auto mb-3";const s=document.createElement("button");s.className="btn btn-outline-dark btn-custom text-break",s.innerText="A\xF1adir ";const f=document.createElement("i");f.id="icon"+e._id,s.addEventListener("click",()=>{oe(e._id),De.click()});const l=document.createElement("i");l.className="fa-solid fa-shopping-cart",c.append(i),r.append(c),r.append(d),s.append(l),s.append(f),p.append(s),o.append(n),a.append(o),a.append(r),a.append(p),t.append(a),k==null||k.append(t)})}re.forEach(e=>{Me(e)});const O=document.querySelector("#registerForm"),se=O.username,ie=document.querySelector("#loginButton"),de=document.querySelector("#registerButton"),B=document.querySelector("#activeBtnLogin"),R=document.querySelector("#activeBtnRegister"),le=document.querySelector("#modalTitle");function Pe(){B.addEventListener("click",()=>{se.classList.add("visually-hidden"),de.classList.add("visually-hidden"),B.classList.add("visually-hidden"),ie.classList.remove("visually-hidden"),R.classList.remove("visually-hidden"),le.innerText="Iniciar sesi\xF3n",O.classList.remove("was-validated")})}function Ue(){R.addEventListener("click",()=>{se.classList.remove("visually-hidden"),de.classList.remove("visually-hidden"),B.classList.remove("visually-hidden"),ie.classList.add("visually-hidden"),R.classList.add("visually-hidden"),le.innerText="Registro",O.classList.add("was-validated")})}let q=[],Be=[],x;const P=document.querySelector("#registerForm"),Re=P.username,b=P.email,$=P.password,je=document.querySelector("#loginButton"),_e=document.querySelector("#registerButton"),Oe=document.querySelector("#formModalClose");function Y(){q=g("users")}Pe();Ue();_e.addEventListener("click",async e=>{if(e.preventDefault(),q.find(t=>t.email===b.value))alert("La cuenta ya est\xE1 registrada");else if(P.checkValidity()){const t=await U(b.value,$.value),a=await U($.value,JSON.stringify({email:b.value,username:Re.value,_id:t,purchase:Be}));Fe(a)}});je.addEventListener("click",e=>{e.preventDefault();const t=q.find(a=>a.email===b.value);t?ue($.value,t.user):alert(b.value+" no registrada")});function Fe(e){let t=ae();q.push({_id:t,email:b.value,user:e}),T("users",q),ue($.value,e)}async function ue(e,t){try{x=JSON.parse(await te(e,t)),x&&(X("user",x),alert("Bienvenido "+x.username),Oe.click(),_(x))}catch{alert("Usuario y/o contrase\xF1a incorrectas")}}const He=document.querySelector("#activateProfile"),Ve=document.querySelector("#activateCart"),Je=document.querySelector("#nav-home-tab"),Z=document.querySelector("#nav-profile-tab");function Ke(){He.addEventListener("click",()=>{Z.click()}),Z.addEventListener("click",()=>{g("users")&&Y(),A("user")&&_(A("user"))}),Ve.addEventListener("click",()=>{Je.click(),g("users")&&Y()})}const Ge=document.querySelector("#loaderSection");document.addEventListener("DOMContentLoaded",()=>{ce(),g("carrito")&&ne(),Ke()});window.onload=()=>{Ge.setAttribute("style","visibility:hidden; opacity:0;")};
